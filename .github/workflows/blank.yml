name: Create and Copy Files to Folders

on:
  push:
    branches:
      - main  # Change as needed

jobs:
  create_and_copy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set up Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '14'  # Specify the Node.js version

      - name: Create session folders and copy files
        run: |
          const fs = require('fs');
          const path = require('path');

          const baseDir = path.join(__dirname, 'session');
          const filesPerFolder = 500;

          // Create session folders and copy files
          fs.promises.readdir(baseDir)
            .then(files => {
              const totalFiles = files.length;
              let folderIndex = 1;

              for (let i = 0; i < totalFiles; i += filesPerFolder) {
                const folderName = folderIndex === 1 ? 'session' : `session${folderIndex}`;
                const folderPath = path.join(baseDir, folderName);

                fs.promises.mkdir(folderPath, { recursive: true })
                  .then(() => {
                    console.log(`Created folder: ${folderName}`);
                    
                    // Copy files to the newly created folder
                    const filesToCopy = files.slice(i, i + filesPerFolder);
                    filesToCopy.forEach(file => {
                      const srcFilePath = path.join(baseDir, file);
                      const destFilePath = path.join(folderPath, file);
                      
                      fs.promises.copyFile(srcFilePath, destFilePath)
                        .then(() => console.log(`Copied ${file} to ${folderName}`))
                        .catch(err => console.error(`Error copying ${file}:`, err));
                    });
                  })
                  .catch(err => console.error(`Error creating folder ${folderName}:`, err));
                folderIndex++;
              }
            })
            .catch(err => console.error('Error reading directory:', err));
